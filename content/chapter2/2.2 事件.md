# 2.2 事件

- ### 2.2.0 目录

  - [<div>3.2 说明设定</div>](#32)
  - [<div>3.3 场景 - 路线选择</div>](#33)
  - [<div>3.4 场景 - 路线选择</div>](#33)

### 2.2.1 说明设定<div id="32">

- 媒体素材编号命名 = [素材类型] - [素材代表的内部代号] - [独立名称或编号] - [有需要再加编号]
  - 比如事件卡图标编号 icon_map_battle
  - 随从卡牌立绘 img_attendant_00？

### 2.2.2 关卡<div id="33">

- #### 关卡表（table_map_levels）

|   关卡编号    |     关卡名称     |   事件池    |
| :-----------: | :--------------: | :---------: |
| map_levels_01 | 被污染的精灵之森 | pool_map_01 |

1. 事件池：按照关卡难度的不同，实例化的事件卡牌组合的池子。一个事件池内有9张牌。

- #### 事件池

| 事件池编号  | 事件强度[回复,商店,献祭,招募,强化,升级] | 战斗卡牌分组编号[战斗,BOSS] |
| :---------: | :-------------------------------------: | :-------------------------: |
| pool_map_01 |            1，1，1，1，1，1             | group_obj_04, group_obj_05  |

##### （1）事件池的普通事件按事件强度的设定来抽取，战斗事件将选取【单位2.1.2】中的卡牌分组作为抽卡依据。

##### （2）事件池抽取原则

| 事件抽取顺序 |                             事件                             | 事件发生次数 |
| :----------: | :----------------------------------------------------------: | :----------: |
|      1       |                             战斗                             |     1~2      |
|      2       |                        回复主角生命值                        |     0~1      |
|      3       |                           卡牌商店                           |     0~1      |
|      4       |                         恶魔献祭事件                         |     0~1      |
|      5       |                  进行步骤6,7的优先顺序判定                   |      /       |
|      6       |                      随从2选1/装备2选1                       |     0~7      |
|      7       |                       获得额外强化属性                       |     0~7      |
|      8       |                       卡牌定向升级机会                       |     0~2      |
|      9       | 如果以上8个流程进行完一遍后，仍有空白事件卡，则从第（2）步开始重新判定，<br />如果已经是次数的极大值则顺延到下一个步骤。比如如果步骤2在第一次流程中已经随机到次数1，<br />则第二次流程时不参与判定，顺延到第（3）步开始 |      /       |

- #### 事件卡表(下方)（table_map_cards）

| 事件卡名称 |   事件卡图标编号    | 事件详情UI编号  |
| :--------: | :-----------------: | :-------------: |
|    战斗    |   icon_map_battle   |  ui_map_battle  |
|    强化    | icon_map_strengthen |        -        |
|    招募    |  icon_map_recruit   | ui_map_recruit  |
|    回复    |  icon_map_restores  | ui_map_restores |
|    商店    |    icon_map_shop    |        -        |
|    献祭    | icon_map_sacrifice  |        -        |
|    升级    |   icon_map_update   |        -        |

- #### 事件详情表(上方)（table_map_details）

|     属性     |                              值                              |
| :----------: | :----------------------------------------------------------: |
| 事件详情编号 |                              /                               |
|   事件等级   |                 N，事件池填入的事件强度匹配                  |
|     标题     |                 直接填值，或者引用卡牌的属性                 |
|   标题按键   |           无值时不显示。有值的时候可以点击唤起页面           |
| 标题按键调用 |                              /                               |
|   卡牌数量   | 当张数超过3时，多余的卡牌会令其一行表示，此时多余的卡牌向左对齐。当值为1和为2时，卡牌会居中显示 |
|   卡面图片   |       显示在卡牌上的固定图片，或者引用卡池中的卡牌图片       |
|   卡牌说明   | 数组形式展示，依照卡牌数量依次载入。当数组内只有一个值的时候，所有的说明都为这个值。 |
|   选择按键   | 数组形式展示，依照卡牌数量依次载入。当数组内只有一个值的时候，所有按键上的说明都为这个值<br />卡牌说明需要额外实现两个效果。【1】可以从某一个说明的池子中读取一条，比如在献祭事件中，<br />卡牌说明的区域就是被削弱的属性【2】可以显示被选中卡牌的某些属性，比如在升级事件中，卡牌说明区域要显示选中卡牌的定向升级效果 |
| 选择按键调用 |              数组形式展示，依照卡牌数量依次载入              |
|   卡池来源   |        事件中需要用到的卡的卡池合集，从卡池中随机挑选        |
|   最大重复   |               卡池内同种卡牌最多能重复出现几次               |

  **通用UI模板**

  ![模板](https://i.loli.net/2021/02/19/fyc5koWM6rw8lSK.png)

- #### 回复

|     属性     |                 值                 |
| :----------: | :--------------------------------: |
| 事件详情编号 |          ui_map_restores           |
|   事件等级   |                 N                  |
|     标题     |            饮用活力源泉            |
|   标题按键   |                 /                  |
| 标题按键调用 |                 /                  |
|   卡牌数量   |                 1                  |
|   卡面图片   |            活力源泉.png            |
|   卡牌说明   | 引用活力源泉，回复英雄N×20点生命值 |
|   选择按键   |                饮用                |
| 选择按键调用 |    方法：回复生命值  数值：N×20    |
|   卡池来源   |                 /                  |
|   最大重复   |                 /                  |

- #### 招募

|     属性     |                  值                  |
| :----------: | :----------------------------------: |
| 事件详情编号 |            ui_map_recruit            |
|   事件等级   |                  N                   |
|     标题     |            招募随从或武器            |
|   标题按键   |                  /                   |
| 标题按键调用 |                  /                   |
|   卡牌数量   |                  2                   |
|   卡面图片   |           引用 卡牌的立绘            |
|   卡牌说明   |           引用 卡牌的名字            |
|   选择按键   |                 招募                 |
| 选择按键调用 | 方法：获得随从或卡牌  来源：卡池来源 |
|   卡池来源   |          group_attendant_0N          |
|   最大重复   |                  1                   |

![zhaomu](https://i.loli.net/2021/03/03/9bzqEHCRDudKvmY.png)

- #### 普通战斗

|     属性     |                           值                           |
| :----------: | :----------------------------------------------------: |
| 事件详情编号 |                     ui_map_battle                      |
|   事件等级   |                           /                            |
|     标题     |                      引用卡牌名称                      |
|   标题按键   |                          查看                          |
| 标题按键调用 |                      怪物阵容列表                      |
|   卡牌数量   |                           2                            |
|   卡面图片   |                    引用 卡牌的立绘                     |
|   卡牌说明   | 【从额外奖励池中随机选择】【从强化怪物属性中随机选择】 |
|   选择按键   |                【直接战斗】【进阶战斗】                |
| 选择按键调用 | 根据选择的战斗方式判断是否在进入战场时给予怪物额外BUFF |
|   卡池来源   |        根据事件池填入的战斗卡牌分组编号确定卡池        |
|   最大重复   |                           2                            |

![战斗场景](https://i.loli.net/2021/02/18/TsMnKbGHQLhEIy3.png)



### 2.2.3 战斗额外奖励池<div id="23">

| 奖励编号  |                       奖励说明                        |      奖励效果      |
| :-------: | :---------------------------------------------------: | :----------------: |
| reward_01 | 进阶战斗成功后，本关卡最终BOSS的初始最大生命值减少30% | BOSS最大生命值-30% |

### 2.2.4 战斗进阶池<div id="24">

|  强化编号  |                奖励说明                |       奖励效果       |
| :--------: | :------------------------------------: | :------------------: |
| advance_01 | 战斗开始时，所有敌方单位获得BUFF“嗜血” | 全体敌方单位获得BUFF |























### 3.4 场景-路线选择缺乏的UI补充和字段说明

- #### 整体场景

  - 【路线选择】场景

- ![路线选择](https://i.loli.net/2021/02/18/9BCaGmg8MsZAc64.png)

- 除了事件卡和事件卡说明两处需要特别列出的说明外，在场景的中心还需要显示【此时关卡的名称】，如上图中的【被污染的精灵之森】

- #### 事件卡

  - 卡面主要由两部分组成，事件标志和事件标题

- ![未标题-1](https://i.loli.net/2021/02/18/qFxUTeScf8gwBuW.png)

- **事件标题**：根据事件的分类分为【战斗】、【升级】、【强化】、【回复】、【招募/锻造】、【商店】、【献祭】这六种事件标题，其中【招募】为获得随从卡牌的事件标题，【锻造】为获得武器卡牌的事件标题。

  - **事件标志**：每个事件都有自己的一种专属标志，其中【战斗】事件的标志较为特殊，需要显示的是此场战斗的主怪立绘。

  - #### 战斗事件卡详情

    - 【战斗】事件详情

- 

  - **文字 - 主怪名称**

- **按键 - 阵容查看：**用于展示主怪携带的随从卡牌和武器卡牌列表

  - **图片 - 主怪立绘**

- **按键 - 直接战斗**：点击后跳转到战斗页面。

  - **按键 - 进阶战斗**：点击后跳转到战斗页面。根据进阶战斗的词条加强战斗难度

- **文字 - 说明**：说明由两部分组成。一部分是加强难度，一部分是战斗成功后的奖励。两部分都从各自的池子中随机抽取一个。

- #### 招募/锻造事件卡详情

  - 【招募/锻造】事件详情

  - 

  - #### 升级事件卡详情

    - 【升级】事件详情

  - ![升级卡牌](https://i.loli.net/2021/02/18/YNb5SEsD93tj68R.png)

  

  - 选择卡牌时，在卡牌选择器中能看见每张卡牌定向升级的效果

- ![升级1](https://i.loli.net/2021/02/18/KfbRwvGzQDsXhr3.png)

- #### 强化事件卡详情

  - 【强化】事件详情

- ![强化](https://i.loli.net/2021/02/18/9dL6O7ZrW3CkoYi.png)

- 根据玩家所处的关卡阶段，从不同级别的强化属性池中随机抽取三种强化属性供玩家选择。

  - 不同的强化属性池可强化的属性类别不同，可提升的数值幅度也不同。

  

  - #### 恶魔献祭事件卡详情

    - 【恶魔献祭】事件详情
    - ![恶魔](https://i.loli.net/2021/02/18/WRxPf8ylQ5IgLjB.png)

    - 根据玩家所处的关卡阶段，献祭后获得的属性奖励复用强化事件中的强化属性池
    - 负面效果来自于另一个池子，不论玩家处于哪个阶段，负面效果都来自于此。当两个池子各随机选取一条拼合时，需要判断正面效果和负面效果是否是同一种，比如 失去x攻速，获得x攻速，只需规避此类情况，其他都随机，不管多离谱。
    - 此事件本身也算负面事件，因为必须选择其中的一种

    

  - #### 商店事件卡详情

    - 【商店】事件详情
    - ![商店](https://i.loli.net/2021/02/18/Jn5TSptj2ONe4Hi.png)

  - 商店每次会刷新出三张武器牌和三张随从牌，前两张必定是低级牌或中级牌（低级70%中级30%），最后一张必是中级牌或高级牌（中级80%高级20%）

    - 玩家可以使用身上已有的同类型卡牌来兑换商店中的卡牌，非同种类型的已有卡牌，无法被使用
    - ![shangdian](https://i.loli.net/2021/02/22/TEXogW86m9NGA2U.png)





| 关卡名称 | 事件生成池 |
| -------- | ---------- |
| | |

事件表，为事件卡的简单数组集合

| 事件表 | 事件卡[] | 强度(预设参数) |
| ------------ | -------- | -------------- |
| 一级战斗卡表 | | |

事件生成池，用于生产新的事件表

| 事件生成池 | 是否打乱 | 表大小 | 默认卡 | [最小重复值,最大重复值,事件表] |
| ---------- | -------- | ------ | ------ | -------------------------------- |
| | | | | |