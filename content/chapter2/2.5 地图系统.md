# 2.5 地图系统

![BO9hB4.png](https://s1.ax1x.com/2020/11/10/BO9hB4.png)



### 2.5.1 岛屿分类

|  岛屿类型  |                           简易说明                           |   是否可在此地建设   |  资源元素是否可再生  |
| :--------: | :----------------------------------------------------------: | :------------------: | :------------------: |
|  核心岛屿  | 整个群岛的主要设施所在地，包含市集，岛主府，警察局，货运停车场 |          否          |          否          |
|  公共岛屿  |    可再生资源的主要产出地，主要设施包含警察局，公路，站台    |          是          |          是          |
|  私人岛屿  |           单个家族的建设区域，主要设施包含家族基地           |          是          |          否          |
| 未探索岛屿 |         尚未与群岛相连接的岛屿，需要通过乘船登岛探索         | 探索完成后同私人岛屿 | 探索完成后同私人岛屿 |



### 岛屿细则

- 所有类型的岛屿在地形生成上没有特别的区别
- 岛屿大小区分：核心岛屿>>公共岛屿>私人岛屿=未探索岛屿



### 岛屿生成规则

- 原文来自 https://blog.csdn.net/woluoyifan/article/details/82156178

  

- #### 方块生成

  首先根据所需要的地图大小创建一个矩形，这是最基础的地图。

  然后随机在矩形内布下若干个点。

  从这些点的坐标出发，每个点生成一个多边形，边数在3~6之间。

  这三步之后，地图大概是这个样子：

  ![img](https://tva1.sinaimg.cn/large/0081Kckwly1gl3zdbqu9hj30b40b474m.jpg)

  这一步实际上是随机把一个大的矩形切割成若干个方块，接下来的操作则把这些方块当做是最基础的元素来进行地图生成。

  

- #### 方块编号

  依照下面的规则来给方块编号：

  最靠近大矩形边缘的方块命名为1；

  剩下的方块里，与1相邻的方块命名为2；

  剩下的方块里，与2相邻的方块命名为3；

  ……

  ![img](https://tva1.sinaimg.cn/large/0081Kckwly1gl3zegzvfvj306k04874g.jpg)

  渐渐把矩形内所有方块都命名了一个数字，这个数字可以简单地代表一个方块距离矩形边沿有多远。接下来，会以数字较大的一些方块作为中心，进行地图下一步的生成。

  

- #### 水域切割

  找到数字最大的方块，假设在第二步里生成的方块最大为n，找到n这个方块，然后将与他相连的从n到n-10的方块视为**核心岛屿**

  选择**核心岛屿**的边缘，以它作为起点，依次随机找与它相邻的、数字编号减一的方块，如下图：
  
  ![img](https://tva1.sinaimg.cn/large/0081Kckwly1gl3zw6l8xqj306k048jrn.jpg)
  
  如上图，灰色的就是**核心岛屿**，蓝色的就是执行上述步骤后选择的方块。
  
  然后随机取**核心岛屿**的边缘作为起点，继续执行若干次上述的操作：
  
  ![img](https://tva1.sinaimg.cn/large/0081Kckwly1gl3zxq1h4hj306k0483yu.jpg)
  
  接着，把所有编号为1的方块和根据上面步骤筛选出的方块全部命名为水域方块：
  
  ![img](https://tva1.sinaimg.cn/large/0081Kckwly1gl404a19s6j306k048aaf.jpg)
  
  至此，就把整个地图从中心出发，切割出大小不一、方向随机的水域，同时整个地图也会被水域包围，充当地图边缘的作用。
  
  
  
- #### *这个步骤为文章里的内容，不过没看太懂一并写上来了*
  
  这一步，我们给地形加一些随机性。
  
  做法很简单，随机在剩余的非水域方块里，把1~3个方块切割出来当做是内陆水域。如果你想整个地图没有岛屿，则只需要保证在切割后不会出现一个四周都是水域的方块即可。切割后如下：
  
  ![img](https://tva1.sinaimg.cn/large/0081Kckwly1gl40lyd06zj306k048wev.jpg)
  
  
  
- #### 其他类型岛屿

  在剩下的非水域方块内随机选择n个点作为其他岛屿的种子方块（此处n根据游戏设置的地图大小而定）

  其中**公共岛屿**的分布大小为n到n-7

  **私人岛屿**的分布大小为n到n-5

  当两个**公共岛屿**有相交的公共方块时，随机选择一方转为生成**私人岛屿**，另一方保持不变

  当两个**私人岛屿**有相交的公共方块时，则按照现有的方块构成将两个岛屿视为同一岛屿，若合并后的新岛屿方块层数符合**公共岛屿**的标准，则将合并后的岛屿视为一个**公共岛屿**

  生成岛屿时，除了种子方块以外，该岛屿其他层数的方块，如果有数量少于3的情况，则将整个岛屿销毁

  将**私人岛屿**生成量的四分之一作为未探索岛屿



- #### 其他

  将经历以上几轮生成岛屿之后仍空白的方块归纳入水域方块

  





### 2.5.2 地形

- 草地
- 土地







### 2.5.3 公路系统

1. 初始道路生成：

   除核心岛屿和未探索岛屿外，其余类型岛屿的初始化道路生成规则均为首先做一条以所有出入口为起点的直线段，线段的终点为岛屿的边界（如图的白色道路），接着将超出白色道路的部分移除（如图黑色部分），剩下的道路即为初始道路，如图：

   [![Dnt7cQ.png](https://s3.ax1x.com/2020/11/18/Dnt7cQ.png)](https://imgchr.com/i/Dnt7cQ)
   
   注：【1】公路均为可以并行两辆货运车辆的双向车道。




2. 公路系统的路面材料分为四种类型：

| 路面类型 | 对车损耗金额/路段 | 过路费参考/路段 | 耐久/路段 | 维修费/路段 |      备注       |
| :------: | :---------------: | :-------------: | :-------: | :---------: | :-------------: |
| 泥土路面 |        15         |        1        |     ∞     |      0      | 造价和材料见5.1 |
| 夯土路面 |        12         |        2        |    300    |     100     | 造价和材料见5.1 |
| 石板路面 |         8         |        3        |    450    |     200     | 造价和材料见5.1 |
| 水泥路面 |         4         |        4        |    600    |     300     | 造价和材料见5.1 |

注：【1】四类路面在画面表现上除了外观颜色有所区别外，无其他变化。

​        【2】私人岛屿的初始路面类型为泥土路面。公共岛屿的路面类型为石板路面。核心岛屿的道路为水泥路面。

​        【3】道路的铺设以（数字） * （数字）米作为一个路段，一条路可以由不同路面类型的路段组成，类似开罗游戏在造道路一样，一个方块代表一段路

[![DuJdOA.png](https://s3.ax1x.com/2020/11/19/DuJdOA.png)](https://imgchr.com/i/DuJdOA)

​        【4】路段的形状有直道和弯道两种。直道可以中心旋转90°，有两种表现形式。弯道环绕左下角进行90°旋转，有4种表现形式。

[![DntT1g.png](https://s3.ax1x.com/2020/11/18/DntT1g.png)](https://imgchr.com/i/DntT1g)

3. 公路系统的归属：

   - 公共岛屿的公路归属于岛主所在家族。在所有公共岛屿的公路上产生的收益都会归入岛主所在家族。
   - 私人岛屿的公路归属分为两个阶段，在岛屿所在家族还未建立站台之前，该岛屿的公路归属于岛主所在家族；在家族建立了站台之后，该岛屿的公路归属于家族，家族可以对其进行升级、改道，并获得其产生的收益，也要负担维护费用。

4. 公路系统维护：
   - 每类路面都有自己独有的耐久度，每有一个车次经过该**路段**，都会造成1点耐久度的损失
   
   - 当**路段**的耐久度降为一半甚至更低时，根据路面类型，他对车损耗金额将会翻倍
   
   - 当一节路段的耐久度降为0时，他会自动降级到低一级的路面类型，并且耐久度初始就为一半。比如有一段路原来的路面类型是水泥路面，耐久为600，当耐久为0时，它就自动退化为石板路面，且耐久度为225（450的一半）。此时再进行修复，也只能修复到450的石板路面，无法重新改进到水泥路面。

   - 道路的维护是按岛统一的结算的，直接将所有路段维护到耐久值的上限。无法单独维护某一路段，但可以单独维护家族旗下某一座岛的公路。
   
   - 列表里展示的维护费是一个路段的耐久度从1修复到上限所需要的费用，实际在计算中，
   
     单个路段的维修费 = （（耐久度上限 - 此时耐久度）/ 耐久度上限） * 维护费
   
     全岛维修费 = SUM（单个路段维修费），所得的金额向上取整。
   
5. 与公路货运相关的内容请查看【5.5 货运元素】
   
