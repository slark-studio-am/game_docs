# 3.0 游戏关卡

### 3.1 某些设定

- 媒体素材编号命名 = [素材类型] - [素材代表的内部代号] - [独立名称或编号] - [有需要再加编号]
  - 比如事件卡图标编号 icon_map_battle
  - 随从卡牌立绘 img_attendant_00？

### 3.2 场景 - 路线选择（内部代号map）

- #### 关卡表（table_map_levels）

|     关卡名称     |   事件池    |
| :--------------: | :---------: |
| 被污染的精灵之森 | pool_map_01 |

1. 事件池：按照关卡难度的不同，实例化的事件卡牌组合的池子。一个事件池内有9张牌。
2. **事件池的抽取遵循以下原则**

（1）确定【战斗事件】的次数，从1和2中随机

（2）确定【回复主角生命值事件】的次数，从0和1中随机

（3）确定【卡牌商店】的次数，从0和1中随机

（4）确定【恶魔献祭事件】的次数。从0和1中随机

5、6两个步骤需要再做一次判定，看谁先进行随机次数的判定

（5）确定【获得单随从，获得单武器，随从武器二选一】的次数，从0到7中随机，再把次数在3个子事件中随机分配

（6）确定【 强化自身属性数值】的次数，从0到7中随机。

（7）确定【卡牌定向升级机会】的次数，从0到7中随机。**第一大关不参与此事件**。

（8）如果以上7个流程进行完一遍后，仍有空白事件卡，则从第（2）步开始重新判定，如果已经是次数的极大值则顺延到下一个步骤。比如如果步骤2在第一次流程中已经随机到次数1，则第二次流程时不参与判定，顺延到第（3）步开始

- #### 事件卡表（table_map_cards）

| 事件卡名称 |   事件卡图标编号    |  事件详情UI编号  |
| :--------: | :-----------------: | :--------------: |
|    战斗    |   icon_map_battle   | ui_map_battle_01 |
|    强化    | icon_map_strengthen |        -         |
|    招募    |  icon_map_recruit   |        -         |
|    锻造    |  icon_map_forging   |                  |
|    回复    |  icon_map_restores  |        -         |
|    商店    |    icon_map_shop    |        -         |
|    献祭    | icon_map_sacrifice  |        -         |
|    升级    |   icon_map_update   |        -         |

- #### 事件详情表（table_map_details）

|   事件详情编号   | 标题 | 标题按键 | 标题按键调用 | 卡牌数量 |    卡牌组编号     |
| :--------------: | :--: | :------: | :----------: | :------: | :---------------: |
| ui_map_battle_01 |  -   | 查看阵容 |   阵容列表   |    2     | details_battle_01 |

|           卡牌说明            |         选择按键         | 选择按键调用 |
| :---------------------------: | :----------------------: | :----------: |
| ["", "战斗成功奖励+难度说明"] | ["直接战斗", “进阶战斗”] |      -       |

1. 标题：普通的标题直接填值。战斗事件的标题希望可以是那只怪的名字，如果不行就还是直接填值吧

2. 标题按键：无值时不显示。有值的时候可以点击唤起页面。

3. 卡牌数量：当张数超过3时，多余的卡牌会令其一行表示，此时多余的卡牌向左对齐。当值为1和为2时，卡牌会居中显示。

4. 卡牌组编号：按给定的规则从指定的卡牌来源抽取除对应卡牌数量的卡牌，填充进UI中

5. 卡牌说明：数组形式展示，依照卡牌数量依次载入。当数组内只有一个值的时候，所有的说明都为这个值。

   卡牌说明需要额外实现两个效果。【1】可以从某一个说明的池子中读取一条，比如在献祭事件中，卡牌说明的区域就是被削弱的属性

   【2】可以显示被选中卡牌的某些属性，比如在升级事件中，卡牌说明区域要显示选中卡牌的定向升级效果

6. 选择按键：数组形式展示，依照卡牌数量依次载入。当数组内只有一个值的时候，所有按键上的说明都为这个值。

7. 选择按键：数组形式展示，依照卡牌数量依次载入。

  **通用UI模板**

  ![模板](https://i.loli.net/2021/02/19/fyc5koWM6rw8lSK.png)

- #### 详情卡牌组表（table_map_details_cards）

|    卡牌组编号     | 卡牌来源(允许多个，数组展示) |   卡牌等级区间    |
| :---------------: | :--------------------------: | :---------------: |
| details_battle_01 |        cards_monsters        | ["low", "middle"] |

1. 卡牌来源：【武器牌】【怪物牌】【随从牌】【属性强化牌】【卡牌选择器 - 升级卡牌时用】
2. 卡牌等级区间：当值为单个时，卡牌抽取时只会在该等级下随机抽取；当值为多个时，卡牌会在多个等级下随机抽取



### 3.4 场景-路线选择缺乏的UI补充和字段说明

- #### 整体场景

  - 【路线选择】场景

- ![路线选择](https://i.loli.net/2021/02/18/9BCaGmg8MsZAc64.png)

- 除了事件卡和事件卡说明两处需要特别列出的说明外，在场景的中心还需要显示【此时关卡的名称】，如上图中的【被污染的精灵之森】

- #### 事件卡

  - 卡面主要由两部分组成，事件标志和事件标题

- ![未标题-1](https://i.loli.net/2021/02/18/qFxUTeScf8gwBuW.png)

- **事件标题**：根据事件的分类分为【战斗】、【升级】、【强化】、【回复】、【招募/锻造】、【商店】、【献祭】这六种事件标题，其中【招募】为获得随从卡牌的事件标题，【锻造】为获得武器卡牌的事件标题。

  - **事件标志**：每个事件都有自己的一种专属标志，其中【战斗】事件的标志较为特殊，需要显示的是此场战斗的主怪立绘。

  - #### 战斗事件卡详情

    - 【战斗】事件详情

- ![战斗场景](https://i.loli.net/2021/02/18/TsMnKbGHQLhEIy3.png)

  - **文字 - 主怪名称**

- **按键 - 阵容查看：**用于展示主怪携带的随从卡牌和武器卡牌列表

  - **图片 - 主怪立绘**

- **按键 - 直接战斗**：点击后跳转到战斗页面。

  - **按键 - 进阶战斗**：点击后跳转到战斗页面。根据进阶战斗的词条加强战斗难度

- **文字 - 说明**：说明由两部分组成。一部分是加强难度，一部分是战斗成功后的奖励。两部分都从各自的池子中随机抽取一个。

- #### 招募/锻造事件卡详情

  - 【招募/锻造】事件详情

  - ![zhaomu](https://i.loli.net/2021/02/18/WreJMTatcfqpnoH.png)

  - #### 升级事件卡详情

    - 【升级】事件详情

  - ![升级卡牌](https://i.loli.net/2021/02/18/YNb5SEsD93tj68R.png)

  

  - 选择卡牌时，在卡牌选择器中能看见每张卡牌定向升级的效果

- ![升级1](https://i.loli.net/2021/02/18/KfbRwvGzQDsXhr3.png)

- #### 强化事件卡详情

  - 【强化】事件详情

- ![强化](https://i.loli.net/2021/02/18/9dL6O7ZrW3CkoYi.png)

- 根据玩家所处的关卡阶段，从不同级别的强化属性池中随机抽取三种强化属性供玩家选择。

  - 不同的强化属性池可强化的属性类别不同，可提升的数值幅度也不同。

  

  - #### 恶魔献祭事件卡详情

    - 【恶魔献祭】事件详情
    - ![恶魔](https://i.loli.net/2021/02/18/WRxPf8ylQ5IgLjB.png)

    - 根据玩家所处的关卡阶段，献祭后获得的属性奖励复用强化事件中的强化属性池
    - 负面效果来自于另一个池子，不论玩家处于哪个阶段，负面效果都来自于此。当两个池子各随机选取一条拼合时，需要判断正面效果和负面效果是否是同一种，比如 失去x攻速，获得x攻速，只需规避此类情况，其他都随机，不管多离谱。
    - 此事件本身也算负面事件，因为必须选择其中的一种

    

  - #### 商店事件卡详情

    - 【商店】事件详情
    - ![商店](https://i.loli.net/2021/02/18/Jn5TSptj2ONe4Hi.png)

  - 商店每次会刷新出三张武器牌和三张随从牌，前两张必定是低级牌或中级牌（低级70%中级30%），最后一张必是中级牌或高级牌（中级80%高级20%）

    - 玩家可以使用身上已有的同类型卡牌来兑换商店中的卡牌，非同种类型的已有卡牌，无法被使用
    - ![shangdian](https://i.loli.net/2021/02/22/TEXogW86m9NGA2U.png)





